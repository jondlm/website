<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="description" content="Website for Ranger: a tech company that builds software for humans."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/website/favicon.svg?v=2"><meta name="generator" content="Astro v4.16.3"><title>Deploying to GitHub pages</title><link rel="stylesheet" href="/website/_astro/blog.-JKPVJtT.css"><script type="module" src="/website/_astro/hoisted.CfyTAeD1.js"></script></head> <body class="px-4 md:px-16 lg:px-32 xl:px-64 2xl:px-96 container mx-auto pb-2"> <div id="sentinal" class="h-6"></div> <div id="nav-stripe" class="print:hidden bg-slate-900 top-0 right-full left-0 w-full fixed opacity-0"></div> <nav id="navbar" class="print:hidden flex mb-8 px-2 pr-5 py-2 bg-slate-900 rounded-lg border border-slate-900"> <div class="flex-auto flex items-center"> <a href="/website"> <img src="/website/_astro/home_handwritten.DLN5N5L3_Z1ER9WK.svg" alt="home" loading="eager" width="65" height="25" decoding="async"> </a> </div> <div class="flex flex-auto items-center justify-end space-x-4"> <a class="text-slate-100" href="/website/values">values</a> <a class="text-slate-100" href="/website/blog">blog</a> <a class="text-slate-100" href="/website/til">TIL</a> <a class="text-slate-100" href="/website/resume">resume</a> </div> </nav>  <article class="md"> <h1 class="mb-2">TIL: Deploying to GitHub pages</h1> <div class="flex items-baseline"> <div class="text-gray-500 mt-0 -mr-2 text-sm"> 2023-08-15 </div> <ul> <li class="text-gray-500 text-xs border border-gray-400 rounded-full px-1.5 mr-1 inline-block">github</li> </ul> </div> <p>GitHub pages is a really nice static site option for small projects. It took me some time to get this right, but here’s <a href="https://github.com/jondlm/graph/blob/8ea246598bdff602d48171f1df4dd60ddddb0fe1/scripts/deploy-gh-pages">a little script</a> that can deploy a project easily from my laptop:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D">#!/usr/bin/env bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># `x` prints every command the script runs.</span></span>
<span class="line"><span style="color:#79B8FF">set</span><span style="color:#79B8FF"> -euox</span><span style="color:#9ECBFF"> pipefail</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#F97583"> !</span><span style="color:#B392F0"> git</span><span style="color:#9ECBFF"> diff</span><span style="color:#E1E4E8">; </span><span style="color:#F97583">then</span></span>
<span class="line"><span style="color:#79B8FF">  printf</span><span style="color:#9ECBFF"> "Please clean up your git state as this script needs to checkout the gh-pages branch.\n"</span></span>
<span class="line"><span style="color:#79B8FF">  exit</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#F97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">TEMP_DIR</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">$(</span><span style="color:#B392F0">mktemp</span><span style="color:#79B8FF"> -d</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Defer cleanup.</span></span>
<span class="line"><span style="color:#B392F0">cleanup</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#B392F0">  ls</span><span style="color:#9ECBFF"> "</span><span style="color:#E1E4E8">$TEMP_DIR</span><span style="color:#9ECBFF">"</span></span>
<span class="line"><span style="color:#B392F0">  rm</span><span style="color:#79B8FF"> -rf</span><span style="color:#9ECBFF"> "</span><span style="color:#E1E4E8">$TEMP_DIR</span><span style="color:#9ECBFF">"</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#79B8FF">trap</span><span style="color:#9ECBFF"> cleanup</span><span style="color:#9ECBFF"> EXIT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Clear previous `dist`.</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> [ </span><span style="color:#F97583">-d</span><span style="color:#E1E4E8"> dist ]; </span><span style="color:#F97583">then</span></span>
<span class="line"><span style="color:#B392F0">  rm</span><span style="color:#79B8FF"> -rf</span><span style="color:#9ECBFF"> dist</span></span>
<span class="line"><span style="color:#F97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Writes new files to `dist`.</span></span>
<span class="line"><span style="color:#B392F0">pnpm</span><span style="color:#9ECBFF"> build</span></span>
<span class="line"><span style="color:#B392F0">cp</span><span style="color:#79B8FF"> -r</span><span style="color:#9ECBFF"> dist/</span><span style="color:#79B8FF">*</span><span style="color:#9ECBFF"> "</span><span style="color:#E1E4E8">$TEMP_DIR</span><span style="color:#9ECBFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Checkout `gh-pages` if it exists. Might not need this `if` check</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#B392F0"> git</span><span style="color:#9ECBFF"> show-ref</span><span style="color:#79B8FF"> --quiet</span><span style="color:#9ECBFF"> refs/heads/gh-pages</span><span style="color:#E1E4E8">; </span><span style="color:#F97583">then</span></span>
<span class="line"><span style="color:#B392F0">  git</span><span style="color:#9ECBFF"> checkout</span><span style="color:#9ECBFF"> gh-pages</span></span>
<span class="line"><span style="color:#F97583">else</span></span>
<span class="line"><span style="color:#B392F0">  git</span><span style="color:#9ECBFF"> checkout</span><span style="color:#79B8FF"> --orphan</span><span style="color:#9ECBFF"> gh-pages</span></span>
<span class="line"><span style="color:#F97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Remove all git tracked files.</span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> rm</span><span style="color:#79B8FF"> -rf</span><span style="color:#9ECBFF"> .</span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> checkout</span><span style="color:#9ECBFF"> main</span><span style="color:#79B8FF"> --</span><span style="color:#9ECBFF"> .gitignore</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Copy over the new assets.</span></span>
<span class="line"><span style="color:#B392F0">cp</span><span style="color:#79B8FF"> -r</span><span style="color:#9ECBFF"> "</span><span style="color:#E1E4E8">$TEMP_DIR</span><span style="color:#9ECBFF">"/</span><span style="color:#79B8FF">*</span><span style="color:#9ECBFF"> .</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Add, commit, push.</span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> add</span><span style="color:#79B8FF"> -A</span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> commit</span><span style="color:#79B8FF"> -m</span><span style="color:#9ECBFF"> "gh-pages deploy"</span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> push</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Return to the main branch.</span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> checkout</span><span style="color:#9ECBFF"> main</span></span>
<span class="line"></span></code></pre>
<p>Briefly, it:</p>
<ol>
<li>Ensures your <code>git diff</code> is clear since it needs to checkout the <code>gh-pages</code> branch later</li>
<li>Clears out any previous <code>dist</code> directory</li>
<li>Runs <code>pnpm build</code> and copies all the output to a temporary dir</li>
<li>Checks out the orphan <code>gh-pages</code> branch. An orphaned branch has its own separate history from the other branches which is helpful for cases like GH pages.</li>
<li>Deletes all the files normally tracked by git</li>
<li>Restores the <code>.gitignore</code> since that’s still useful here</li>
<li>Copies over the built files from the temporary directory</li>
<li>Stages all the built files and commits the built files</li>
<li>Pushes the commit</li>
<li>Checks out the main branch again to restore the previous state</li>
</ol>
<p><strong>Using Parcel?</strong> Make sure you add this to your <code>package.json</code> that matches your GH repo name:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#9ECBFF">  "targets"</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">    "default"</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">      "publicUrl"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"/my-repo-name"</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"></span></code></pre>
<p><strong>Using Astro?</strong> Be sure to define <code>site</code> and <code>base</code> in your <code>astro.config.mjs</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#B392F0"> defineConfig</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  site: </span><span style="color:#9ECBFF">"https://jondlm.github.io/website/"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  base: </span><span style="color:#9ECBFF">"website"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span></code></pre> </article>   </body></html>