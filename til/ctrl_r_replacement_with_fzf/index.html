<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="description" content="Jon's personal site."><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/website/favicon.svg?v=2"><link rel="alternate" type="application/rss+xml" title="Chez Jon" href="https://jondlm.github.io/website/rss.xml"><meta name="generator" content="Astro v4.16.3"><title>CTRL-R replacement with fzf</title><link rel="stylesheet" href="/website/_astro/blog.-JKPVJtT.css"><script type="module" src="/website/_astro/hoisted.CfyTAeD1.js"></script></head> <body class="px-4 md:px-16 lg:px-32 xl:px-64 2xl:px-96 container mx-auto pb-2"> <div id="sentinal" class="h-6"></div> <div id="nav-stripe" class="print:hidden bg-slate-900 top-0 right-full left-0 w-full fixed opacity-0"></div> <nav id="navbar" class="print:hidden flex mb-8 px-2 pr-5 py-2 bg-slate-900 rounded-lg border border-slate-900"> <div class="flex-auto flex items-center"> <a href="/website"> <img src="/website/_astro/home_handwritten.DLN5N5L3_Z1ER9WK.svg" alt="home" loading="eager" width="65" height="25" decoding="async"> </a> </div> <div class="flex flex-auto items-center justify-end space-x-4"> <a class="text-slate-100" href="/website/values">values</a> <a class="text-slate-100" href="/website/blog">blog</a> <a class="text-slate-100" href="/website/til">TIL</a> <a class="text-slate-100" href="/website/resume">resume</a> </div> </nav>  <article class="md"> <h1 class="mb-2">TIL: CTRL-R replacement with fzf</h1> <div class="flex items-baseline"> <div class="text-gray-500 mt-0 -mr-2 text-sm"> 2024-02-23 </div> <ul> <li class="text-gray-500 text-xs border border-gray-400 rounded-full px-1.5 mr-1 inline-block">shell</li> </ul> </div> <p>Add this to <code>.bashrc</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">fzf_history</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">	READLINE_LINE</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">$(</span><span style="color:#79B8FF">history</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> sed</span><span style="color:#9ECBFF"> 's/^.\{27\}//'</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> fzf</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">	READLINE_POINT</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">${</span><span style="color:#F97583">#</span><span style="color:#E1E4E8">READLINE_LINE}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">bind</span><span style="color:#79B8FF"> -x</span><span style="color:#9ECBFF"> '"\C-r": fzf_history'</span></span>
<span class="line"></span></code></pre>
<p>And here’s one for zsh:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="zsh"><code><span class="line"><span style="color:#B392F0">fzf_history</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">  BUFFER</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">$(</span><span style="color:#79B8FF">history</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> sed</span><span style="color:#9ECBFF"> 's/^.\{7\}//'</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> fzf</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">  CURSOR</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">$#BUFFER</span></span>
<span class="line"><span style="color:#B392F0">  zle</span><span style="color:#9ECBFF"> reset-prompt</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">zle</span><span style="color:#79B8FF"> -N</span><span style="color:#9ECBFF"> fzf_history</span></span>
<span class="line"><span style="color:#79B8FF">bindkey</span><span style="color:#9ECBFF"> '^R'</span><span style="color:#9ECBFF"> fzf_history</span></span>
<span class="line"></span></code></pre>
<p>That assumes 27 characters of leading junk in the <code>history</code> command. I’ve found this to be variable on different machines.</p>
<p>This works because of the features provided by Bash’s Readline library.</p>
<ol>
<li><code>READLINE_LINE</code>: This special variable determines the contents of the line. When you set <code>READLINE_LINE=$(history | sed 's/^.\{27\}//' | fzf)</code>, it changes the contents of the current input line to the result of the command inside <code>$()</code> which is the command you select from <code>fzf</code>.</li>
<li><code>READLINE_POINT</code>: This special variable specifies the position of the cursor. When you run <code>READLINE_POINT=${#READLINE_LINE}</code>, it sets the cursor position to the end of the current input line.</li>
<li><code>bind -x '"\C-r": fzf_history'</code>: this binds <code>Ctrl-r</code> to the function <code>fzf_history</code>. The <code>-x</code> option allows bound functions to execute shell commands, in this case changing the <code>READLINE_LINE</code> and <code>READLINE_POINT</code> variables.</li>
</ol>
<p>When <code>Ctrl-r</code> is pressed, it triggers the <code>fzf_history</code> function that runs the <code>fzf</code> interface to choose a command from history and places it on the command line. The cursor is moved to the end of the line, ready for you to press Enter to execute the command or modify it if needed.</p> </article>   </body></html>